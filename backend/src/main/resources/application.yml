# =============================================================================
# Rewine Backend - Application Configuration (Common Defaults)
# =============================================================================
# Profile-specific configuration:
#   - local: PostgreSQL for local development (default)
#   - test: H2 in-memory for unit tests
#   - integration: Testcontainers PostgreSQL
#   - production: Production PostgreSQL
# =============================================================================

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:local}

  application:
    name: rewine-backend
    version: 0.0.1-SNAPSHOT

  # Common Jackson Configuration
  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false
    time-zone: UTC

# Server Configuration
server:
  port: ${SERVER_PORT:8080}
  servlet:
    context-path: /api/v1
  shutdown: graceful

# Actuator Configuration
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,loggers
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true
      group:
        readiness:
          include: readinessState,db
        liveness:
          include: livenessState
    info:
      enabled: true
    metrics:
      enabled: true
    env:
      enabled: true
    loggers:
      enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true
    db:
      enabled: true

# Application Info
info:
  app:
    name: ${spring.application.name}
    version: ${spring.application.version}
    description: Wine Discovery Platform - Backend API

# API Contact Configuration
api:
  contact:
    name: Rewine Team
    email: support@rewine.com

# Logging Configuration (common defaults)
logging:
  level:
    root: INFO
    com.rewine: ${LOG_LEVEL_APP:INFO}
    org.springframework.security: INFO
    org.hibernate.SQL: ${LOG_LEVEL_SQL:WARN}
    org.flywaydb: INFO

# OpenAPI Configuration
springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    operationsSorter: method
    tagsSorter: alpha
    displayRequestDuration: true
    filter: true
    url: /api-docs
    disable-swagger-default-url: true
  show-actuator: false
  packages-to-scan: com.rewine.backend.controller
  paths-to-match: /**
  paths-to-exclude: /actuator/**

# JWT Configuration
jwt:
  issuer: ${JWT_ISSUER:rewine-backend}
  secret: ${JWT_SECRET:rewine-development-secret-key-change-in-production-minimum-256-bits}
  access-token-expiration: ${JWT_ACCESS_EXPIRATION:900000}    # 15 minutes in milliseconds
  refresh-token-expiration: ${JWT_REFRESH_EXPIRATION:604800000} # 7 days in milliseconds

# =============================================================================
# Rewine Configuration - Common Defaults
# Profile-specific settings (local, production) can override these
# =============================================================================
rewine:
  # CORS Configuration
  cors:
    enabled: true
    allowed-origins:
      - http://localhost:3000
      - http://localhost:4173
      - http://localhost:5173
    allowed-methods:
      - GET
      - POST
      - PUT
      - DELETE
      - PATCH
      - OPTIONS
    allowed-headers:
      - Authorization
      - Content-Type
      - X-Request-Id
      - Accept
      - Origin
      - X-Requested-With
    exposed-headers:
      - X-Request-Id
      - X-RateLimit-Remaining
      - X-RateLimit-Limit
      - X-RateLimit-Reset
    allow-credentials: true
    max-age: 3600

  # Rate Limiting Configuration
  rate-limit:
    enabled: true
    cache-expiration-seconds: 300
    max-cache-size: 10000
    login:
      requests: 10
      window-seconds: 60
    register:
      requests: 5
      window-seconds: 60
    public-get:
      requests: 120
      window-seconds: 60
    authenticated:
      requests: 200
      window-seconds: 60

  # Security Headers Configuration
  security:
    headers:
      enabled: true
      content-type-options: true
      frame-options: DENY
      referrer-policy: strict-origin-when-cross-origin
      content-security-policy: "default-src 'none'; frame-ancestors 'none'"
      permissions-policy: "geolocation=(), camera=(), microphone=()"
      xss-protection: true
      hsts:
        enabled: false  # Enable only in production with HTTPS
        max-age-seconds: 31536000
        include-subdomains: true
        preload: false

  # AI Configuration
  ai:
    provider: ${AI_PROVIDER:mock}
    enabled: ${AI_ENABLED:true}
    openai:
      base-url: ${OPENAI_BASE_URL:https://api.openai.com/v1}
      api-key: ${OPENAI_API_KEY:}
      model: ${OPENAI_MODEL:gpt-4o-mini}
      max-tokens: ${OPENAI_MAX_TOKENS:2000}
      temperature: ${OPENAI_TEMPERATURE:0.7}
    http:
      connect-timeout-seconds: ${AI_CONNECT_TIMEOUT:10}
      read-timeout-seconds: ${AI_READ_TIMEOUT:60}
      max-retries: ${AI_MAX_RETRIES:2}
      logging-enabled: ${AI_HTTP_LOGGING:true}

  # Maps Configuration
  maps:
    enabled: ${MAPS_ENABLED:false}
    provider: ${MAPS_PROVIDER:openstreetmap}
    api-key: ${GOOGLE_MAPS_API_KEY:}
    default-map-style: roadmap
    default-image-width: 640
    default-image-height: 400

